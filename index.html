<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flag Arena</title>
<style>
body{margin:0;overflow:hidden;background:white;font-family:Arial;}
#bgText{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:120px;font-weight:bold;
color:rgba(0,0,0,0.05);
pointer-events:none;
white-space:nowrap;
}
#topWins{
position:absolute;top:20px;right:20px;
background:rgba(0,0,0,0.85);
color:white;padding:15px;
border-radius:10px;font-size:14px;
width:220px;
}
#topWins h3{margin:0 0 10px 0;text-align:center;}
#countdown{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:80px;font-weight:bold;color:black;
}
#eliminated{
position:absolute;bottom:10px;left:50%;
transform:translateX(-50%);
display:flex;flex-wrap:wrap;
justify-content:center;
max-width:90%;gap:5px;
}
.elimItem{text-align:center;font-size:10px;}
canvas{display:block;margin:auto;}
</style>
</head>
<body>

<div id="bgText">FLAG ARENA</div>
<div id="topWins"><h3>TOP WINS</h3><div id="winsList"></div></div>
<div id="countdown"></div>
<div id="eliminated"></div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

const centerX=canvas.width/2;
const centerY=canvas.height/2;
const radius=250;
const gapSize=Math.PI/6;

let arenaAngle=0;
let flags=[];
let eliminated=[];
let wins={};
let countdown=10;
let running=false;

const BASE_SPEED=4;
const PUSH_FORCE=0.15;

const countries=[
"tr","us","de","fr","br","jp","it","gb","es","ru",
"cn","ar","nl","se","no","pl","gr","mx","ca","kr",
"in","pt","ua","ro","hu","fi","dk","ch","be","cl"
];

function createFlags(){
flags=[];
countries.forEach(code=>{
let angle=Math.random()*Math.PI*2;
flags.push({
code,
x:centerX+Math.cos(angle)*(radius-50),
y:centerY+Math.sin(angle)*(radius-50),
vx:(Math.random()-0.5)*BASE_SPEED,
vy:(Math.random()-0.5)*BASE_SPEED,
size:26
});
});
}

function drawArena(){
arenaAngle+=0.02;
ctx.beginPath();
ctx.arc(centerX,centerY,radius,0,Math.PI*2);
ctx.strokeStyle="black";
ctx.lineWidth=8;
ctx.stroke();

ctx.save();
ctx.translate(centerX,centerY);
ctx.rotate(arenaAngle);
ctx.beginPath();
ctx.arc(0,0,radius+1,-gapSize/2,gapSize/2);
ctx.strokeStyle="white";
ctx.lineWidth=10;
ctx.stroke();
ctx.restore();
}

function updateFlags(){

// FLAG VS FLAG PUSH SYSTEM
for(let i=0;i<flags.length;i++){
for(let j=i+1;j<flags.length;j++){

let a=flags[i];
let b=flags[j];

let dx=b.x-a.x;
let dy=b.y-a.y;
let dist=Math.sqrt(dx*dx+dy*dy);

if(dist<30 && dist>0){
let nx=dx/dist;
let ny=dy/dist;

// karşılıklı itiş
a.vx-=nx*PUSH_FORCE;
a.vy-=ny*PUSH_FORCE;
b.vx+=nx*PUSH_FORCE;
b.vy+=ny*PUSH_FORCE;
}
}
}

// hareket
flags.forEach((f,i)=>{

f.x+=f.vx;
f.y+=f.vy;

// arena collision
let dx=f.x-centerX;
let dy=f.y-centerY;
let dist=Math.sqrt(dx*dx+dy*dy);

if(dist+f.size/2>radius){

let angle=Math.atan2(dy,dx)-arenaAngle;
if(angle<0) angle+=Math.PI*2;

if(angle<gapSize || angle>Math.PI*2-gapSize){
eliminateFlag(i);
return;
}

// duvara çarpma bounce
let nx=dx/dist;
let ny=dy/dist;
let dot=f.vx*nx+f.vy*ny;
f.vx-=2*dot*nx;
f.vy-=2*dot*ny;

f.x=centerX+nx*(radius-f.size/2);
f.y=centerY+ny*(radius-f.size/2);
}
});
}

function eliminateFlag(index){
let flag=flags[index];
eliminated.push(flag.code);
displayEliminated(flag.code);
flags.splice(index,1);

if(flags.length===1){
setTimeout(()=>{
let winner=flags[0].code;
wins[winner]=(wins[winner]||0)+1;
updateTopWins();
resetGame();
},1000);
}
}

function drawFlags(){
flags.forEach(f=>{
let img=new Image();
img.src="https://flagcdn.com/w40/"+f.code+".png";
ctx.drawImage(img,f.x-15,f.y-15,30,20);
ctx.fillStyle="black";
ctx.font="10px Arial";
ctx.textAlign="center";
ctx.fillText(f.code.toUpperCase(),f.x,f.y+18);
});
}

function displayEliminated(code){
let div=document.createElement("div");
div.className="elimItem";
div.innerHTML=`<img src="https://flagcdn.com/w20/${code}.png"><br>${code.toUpperCase()}`;
document.getElementById("eliminated").appendChild(div);
}

function updateTopWins(){
let list=document.getElementById("winsList");
list.innerHTML="";
let sorted=Object.entries(wins).sort((a,b)=>b[1]-a[1]).slice(0,10);
sorted.forEach(([code,count])=>{
list.innerHTML+=`<div><img src="https://flagcdn.com/w20/${code}.png"> ${count}</div>`;
});
}

function resetGame(){
flags=[];
eliminated=[];
document.getElementById("eliminated").innerHTML="";
countdown=10;
running=false;
startCountdown();
}

function startCountdown(){
let cd=document.getElementById("countdown");
let interval=setInterval(()=>{
cd.innerText=countdown;
countdown--;
if(countdown<0){
clearInterval(interval);
cd.innerText="";
createFlags();
running=true;
animate();
}
},1000);
}

function animate(){
if(!running) return;
ctx.clearRect(0,0,canvas.width,canvas.height);
drawArena();
updateFlags();
drawFlags();
requestAnimationFrame(animate);
}

startCountdown();
</script>
</body>
</html>
