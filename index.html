<!DOCTYPE html>
<html>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<head>
<meta charset="UTF-8">
<title>FLAG ARENA</title>
<style>
body{
margin:0;
background:#ffffff;
overflow:hidden;
font-family:Arial,Helvetica,sans-serif;
}

#bgTitle{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:120px;
font-weight:900;
color:rgba(0,0,0,0.05);
pointer-events:none;
user-select:none;
}

#arena{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
}

#eliminated{
position:absolute;
bottom:20px;
left:50%;
transform:translateX(-50%);
display:flex;
flex-wrap:wrap;
justify-content:center;
width:90%;
gap:6px;
}

#topWins{
position:absolute;
top:20px;
right:20px;
background:rgba(0,0,0,0.7);
color:#fff;
padding:15px;
border-radius:10px;
width:200px;
}

#topWins h3{
margin:0 0 10px 0;
text-align:center;
}

.winItem{
display:flex;
align-items:center;
margin-bottom:6px;
font-size:14px;
}

.winItem img{
width:20px;
margin-right:6px;
}

#countdown{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:80px;
font-weight:bold;
color:#000;
}
</style>
</head>
<body>

<div id="bgTitle">FLAG ARENA</div>
<div id="countdown"></div>
<canvas id="arena"></canvas>
<div id="eliminated"></div>

<div id="topWins">
<h3>TOP WINS</h3>
<div id="winsList"></div>
</div>

<script>
const canvas=document.getElementById("arena");
const ctx=canvas.getContext("2d");
canvas.width=700;
canvas.height=700;

const centerX=canvas.width/2;
const centerY=canvas.height/2;
const radius=280;

let arenaAngle=0;
const rotationSpeed=0.01;
const gapSize=0.4;

let flags=[];
let eliminated=[];
let wins={};

const countryCodes=[
"us","tr","de","fr","br","jp","cn","it","gb","es",
"ru","in","ca","au","mx","ar","nl","se","no","fi",
"pl","ch","kr","sa","za","eg","gr","pt","be","at"
];

function createFlags(){
flags=[];
countryCodes.forEach(code=>{
const img=new Image();
img.src=`https://flagcdn.com/w40/${code}.png`;

const angle=Math.random()*Math.PI*2;
const speed=3+Math.random()*2;

flags.push({
code:code,
img:img,
x:centerX+Math.cos(angle)*(radius-40),
y:centerY+Math.sin(angle)*(radius-40),
vx:Math.cos(angle)*speed,
vy:Math.sin(angle)*speed,
size:28
});
});
}

function drawArena(){
ctx.save();
ctx.translate(centerX,centerY);
ctx.rotate(arenaAngle);
ctx.beginPath();
ctx.arc(0,0,radius, gapSize/2, Math.PI*2-gapSize/2);
ctx.lineWidth=8;
ctx.strokeStyle="#000";
ctx.stroke();
ctx.restore();
}

function updateFlags(){

let speedMultiplier=1;

if(flags.length<=10 && flags.length>5) speedMultiplier=1.15;
if(flags.length<=5 && flags.length>2) speedMultiplier=1.35;
if(flags.length<=2) speedMultiplier=1.55;

flags.forEach((f,i)=>{

const maxSpeed=8;
let currentSpeed=Math.sqrt(f.vx*f.vx+f.vy*f.vy);
if(currentSpeed>maxSpeed){
f.vx=(f.vx/currentSpeed)*maxSpeed;
f.vy=(f.vy/currentSpeed)*maxSpeed;
}

f.x+=f.vx*speedMultiplier;
f.y+=f.vy*speedMultiplier;

let dx=f.x-centerX;
let dy=f.y-centerY;
let dist=Math.sqrt(dx*dx+dy*dy);

if(dist+f.size/2>radius){
let worldAngle=Math.atan2(dy,dx);
let relativeAngle=worldAngle-arenaAngle;

while(relativeAngle<0) relativeAngle+=Math.PI*2;
while(relativeAngle>Math.PI*2) relativeAngle-=Math.PI*2;

let gapStart=Math.PI*2-gapSize/2;
let gapEnd=gapSize/2;

if(relativeAngle>=gapStart || relativeAngle<=gapEnd){
eliminate(i);
}else{
let nx=dx/dist;
let ny=dy/dist;
f.vx-=2*(f.vx*nx+f.vy*ny)*nx;
f.vy-=2*(f.vx*nx+f.vy*ny)*ny;
}
}
});
}

function eliminate(index){
const removed=flags.splice(index,1)[0];
eliminated.push(removed);

const img=document.createElement("img");
img.src=removed.img.src;
img.width=20;
document.getElementById("eliminated").appendChild(img);

if(flags.length===1){
setTimeout(()=>{
declareWinner(flags[0]);
},800);
}
}

function declareWinner(flag){
wins[flag.code]=(wins[flag.code]||0)+1;
updateWins();
setTimeout(startGame,2000);
}

function updateWins(){
const sorted=Object.entries(wins).sort((a,b)=>b[1]-a[1]).slice(0,10);
const list=document.getElementById("winsList");
list.innerHTML="";
sorted.forEach(([code,count])=>{
const div=document.createElement("div");
div.className="winItem";
div.innerHTML=`<img src="https://flagcdn.com/w20/${code}.png"> ${count}`;
list.appendChild(div);
});
}

function drawFlags(){
flags.forEach(f=>{
ctx.drawImage(f.img,f.x-f.size/2,f.y-f.size/2,f.size,f.size);
});
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
arenaAngle+=rotationSpeed;
drawArena();
updateFlags();
drawFlags();
requestAnimationFrame(animate);
}

function countdownStart(){
let count=10;
const el=document.getElementById("countdown");
el.innerText=count;
const interval=setInterval(()=>{
count--;
el.innerText=count;
if(count<=0){
clearInterval(interval);
el.innerText="";
startGame();
}
},1000);
}

function startGame(){
document.getElementById("eliminated").innerHTML="";
createFlags();
}

createFlags();
animate();
countdownStart();
</script>

</body>
</html>
