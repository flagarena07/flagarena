<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flag Arena</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<style>
body{margin:0;overflow:hidden;background:#fff;font-family:Arial;}
#bgTitle{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:120px;font-weight:900;
color:rgba(0,0,0,0.05);
pointer-events:none;
}
#countdown{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:80px;font-weight:bold;
}
#winner{
position:absolute;top:20px;left:50%;
transform:translateX(-50%);
font-size:30px;font-weight:bold;
}
</style>
</head>
<body>

<div id="bgTitle">FLAG ARENA</div>
<div id="countdown">10</div>
<div id="winner"></div>

<script>
const {Engine,Render,Runner,World,Bodies,Body,Composite,Events} = Matter;

const engine = Engine.create();
engine.gravity.y = 0;

const world = engine.world;

const width = window.innerWidth;
const height = window.innerHeight;
const centerX = width/2;
const centerY = height/2;
const radius = 280;
const gapSize = 50;

const render = Render.create({
element: document.body,
engine: engine,
options:{
width:width,
height:height,
wireframes:false,
background:'transparent'
}
});

Render.run(render);
Runner.run(Runner.create(), engine);

let flags=[];
let arenaParts=[];
let arena;
let gameStarted=false;

const countries=[
"tr","us","de","fr","br","gb","it","es","ru","jp",
"cn","in","kr","mx","ar","nl","se","ch","sa","au",
"ca","be","pl","no","dk","fi","pt","gr","hu","cz",
"ua","ro","sk","bg","rs","hr","cl","co","pe","ve"
];

function createArena(){
arena = Composite.create();

for(let i=0;i<360;i+=4){
if(i>180-gapSize/2 && i<180+gapSize/2) continue;

let angle=i*Math.PI/180;
let x=centerX+radius*Math.cos(angle);
let y=centerY+radius*Math.sin(angle);

let wall=Bodies.rectangle(x,y,10,20,{
isStatic:true,
angle:angle,
render:{fillStyle:"#000"}
});

Composite.add(arena, wall);
arenaParts.push(wall);
}

World.add(world, arena);
}

function rotateArena(){
arenaParts.forEach(part=>{
Body.rotate(part,0.01);
let dx=part.position.x-centerX;
let dy=part.position.y-centerY;
let angle=Math.atan2(dy,dx)+0.01;
let x=centerX+radius*Math.cos(angle);
let y=centerY+radius*Math.sin(angle);
Body.setPosition(part,{x,y});
});
}

function createFlags(){
countries.forEach(code=>{
let x=centerX+(Math.random()*200-100);
let y=centerY+(Math.random()*200-100);

let body=Bodies.circle(x,y,18,{
restitution:1,
friction:0,
frictionAir:0,
render:{
sprite:{
texture:`https://flagcdn.com/w80/${code}.png`,
xScale:0.5,
yScale:0.5
}
}
});

Body.setVelocity(body,{
x:(Math.random()-0.5)*12,
y:(Math.random()-0.5)*12
});

body.country=code;
flags.push(body);
World.add(world,body);
});
}

function startCountdown(){
let count=10;
const cd=document.getElementById("countdown");
cd.innerText=count;

let interval=setInterval(()=>{
count--;
cd.innerText=count;
if(count===0){
clearInterval(interval);
setTimeout(()=>{
cd.style.display="none";
startGame();
},500);
}
},1000);
}

function startGame(){
gameStarted=true;
}

Events.on(engine,"beforeUpdate",()=>{
if(!gameStarted) return;
rotateArena();
});

Events.on(engine,"afterUpdate",()=>{
if(!gameStarted) return;

flags.forEach(flag=>{
let dx=flag.position.x-centerX;
let dy=flag.position.y-centerY;
let dist=Math.sqrt(dx*dx+dy*dy);

if(dist>radius+25){
World.remove(world,flag);
flags=flags.filter(f=>f!==flag);
}
});

if(flags.length===1){
document.getElementById("winner").innerText="Winner: "+flags[0].country.toUpperCase();
setTimeout(()=>location.reload(),5000);
gameStarted=false;
}
});

createArena();
createFlags();
startCountdown();
</script>
</body>
</html>
