<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FLAG ARENA</title>
<style>
body{
margin:0;
background:#0c0f1a;
overflow:hidden;
font-family:Arial, sans-serif;
color:white;
}
#bgText{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:130px;
font-weight:900;
opacity:0.05;
pointer-events:none;
white-space:nowrap;
}
#countdown{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:90px;
font-weight:bold;
}
#winner{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
font-size:30px;
font-weight:bold;
}
#topWins{
position:fixed;
top:20px;
right:20px;
width:200px;
}
#topWins h3{
margin:0 0 10px 0;
}
.topItem{
display:flex;
align-items:center;
margin-bottom:6px;
font-size:14px;
}
.topItem img{
width:25px;
margin-right:6px;
}
canvas{
display:block;
margin:auto;
}
</style>
</head>
<body>

<div id="bgText">FLAG ARENA</div>
<div id="countdown"></div>
<div id="winner"></div>

<div id="topWins">
<h3>TOP WINS</h3>
<div id="topList"></div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=1000;
canvas.height=800;

const cx=canvas.width/2;
const cy=canvas.height/2;
const R=320;

const GAP=Math.PI/7;
let arenaAngle=0;

let flags=[];
let eliminated=[];
let wins={};
let running=false;
let winnerDone=false;

const countries=[ "tr","us","de","fr","it","es","br","ar","jp","cn",
"ru","gb","ca","mx","kr","sa","au","in","nl","ch",
"se","no","fi","dk","pl","be","gr","pt","ua","ro",
"cz","at","hu","bg","rs","hr","sk","si","ee","lv",
"lt","ie","is","cl","co","pe","ve","za","eg","ma"
];

let images={};

class Ball{
constructor(code){
this.code=code;
this.r=18;

let a=Math.random()*Math.PI*2;
let rad=Math.random()*(R-60);
this.x=cx+Math.cos(a)*rad;
this.y=cy+Math.sin(a)*rad;

let sp=10+Math.random()*4; // HIZ ARTIRILDI
let ang=Math.random()*Math.PI*2;
this.vx=Math.cos(ang)*sp;
this.vy=Math.sin(ang)*sp;

this.alive=true;
}
update(){
if(!this.alive||!running)return;

this.x+=this.vx;
this.y+=this.vy;

let dx=this.x-cx;
let dy=this.y-cy;
let dist=Math.sqrt(dx*dx+dy*dy);
let ang=Math.atan2(dy,dx)-arenaAngle;

if(dist+this.r>=R){

if(ang>-GAP/2 && ang<GAP/2){
this.alive=false;
eliminated.push(this);
return;
}

let nx=dx/dist;
let ny=dy/dist;
let dot=this.vx*nx+this.vy*ny;
this.vx-=2*dot*nx;
this.vy-=2*dot*ny;

let boost=1.05; // duvara Ã§arpÄ±nca hÄ±z kaybÄ± olmasÄ±n
this.vx*=boost;
this.vy*=boost;
}
}
draw(){
if(!this.alive)return;
ctx.drawImage(images[this.code],this.x-18,this.y-12,36,24);
}
}

function drawArena(){
ctx.save();
ctx.translate(cx,cy);
ctx.rotate(arenaAngle);
ctx.beginPath();
ctx.arc(0,0,R,GAP/2,Math.PI*2-GAP/2);
ctx.lineWidth=5;
ctx.strokeStyle="white";
ctx.stroke();
ctx.restore();
}

function drawEliminated(){
let perRow=18;
let startY=canvas.height-150;

eliminated.forEach((f,i)=>{
let col=i%perRow;
let row=Math.floor(i/perRow);
let x=30+col*50;
let y=startY+row*40;
ctx.drawImage(images[f.code],x,y,40,26);
});
}

function updateTopWins(){
let sorted=Object.entries(wins).sort((a,b)=>b[1]-a[1]).slice(0,10);
let html="";
sorted.forEach(item=>{
html+=`<div class="topItem">
<img src="https://flagcdn.com/w40/${item[0]}.png">
${item[1]} wins
</div>`;
});
document.getElementById("topList").innerHTML=html;
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);

if(running) arenaAngle+=0.05; // Ã‡EMBER HIZLI DÃ–NER

drawArena();

flags.forEach(f=>{
f.update();
f.draw();
});

drawEliminated();

let alive=flags.filter(f=>f.alive);

if(alive.length===1 && running && !winnerDone){
winnerDone=true;
running=false;
let code=alive[0].code;
document.getElementById("winner").innerText="ðŸ† "+code.toUpperCase()+" WINS!";
wins[code]=(wins[code]||0)+1;
updateTopWins();
setTimeout(reset,3000);
}

requestAnimationFrame(animate);
}

function countdown(){
let c=10;
let el=document.getElementById("countdown");
el.innerText=c;
let i=setInterval(()=>{
c--;
el.innerText=c;
if(c<=0){
clearInterval(i);
el.innerText="";
running=true;
}
},1000);
}

function reset(){
eliminated=[];
flags=[];
winnerDone=false;
document.getElementById("winner").innerText="";
init();
countdown();
}

function init(){
countries.forEach(c=>{
flags.push(new Ball(c));
});
}

function loadImages(cb){
let loaded=0;
countries.forEach(c=>{
let img=new Image();
img.src=`https://flagcdn.com/w80/${c}.png`;
img.onload=()=>{
loaded++;
if(loaded===countries.length) cb();
}
images[c]=img;
});
}

loadImages(()=>{
init();
countdown();
animate();
});
</script>
</body>
</html>
