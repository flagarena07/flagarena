<script>
const canvas = document.getElementById("arenaCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 100;

let centerX = canvas.width / 2;
let centerY = canvas.height / 2;
let radius = Math.min(canvas.width, canvas.height) / 2 - 80;
let shrinkSpeed = 0.02;

const gapSize = Math.PI / 8; // boÅŸluk geniÅŸliÄŸi
let gapAngle = Math.PI / 2;  // boÅŸluÄŸun konumu (aÅŸaÄŸÄ±da)

const eliminatedDiv = document.getElementById("eliminated");

const countries = Array.from({length:195}, (_,i)=>({
  name: "COUNTRY " + (i+1),
  emoji: "ðŸ³ï¸",
  x: centerX + Math.random()*200-100,
  y: centerY + Math.random()*200-100,
  dx: (Math.random()-0.5)*2,
  dy: (Math.random()-0.5)*2,
  eliminated:false
}));

function drawArena(){
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, gapAngle + gapSize/2, gapAngle - gapSize/2 + Math.PI*2);
  ctx.strokeStyle = "white";
  ctx.lineWidth = 3;
  ctx.stroke();
}

function drawFlags(){
  countries.forEach(c=>{
    if(c.eliminated) return;
    ctx.font = "16px Arial";
    ctx.textAlign = "center";
    ctx.fillText(c.emoji, c.x, c.y);
    ctx.font = "8px Arial";
    ctx.fillText(c.name, c.x, c.y+10);
  });
}

function update(){
  radius -= shrinkSpeed;

  countries.forEach(c=>{
    if(c.eliminated) return;

    c.x += c.dx;
    c.y += c.dy;

    let dx = c.x - centerX;
    let dy = c.y - centerY;
    let dist = Math.sqrt(dx*dx + dy*dy);

    let angle = Math.atan2(dy, dx);
    if(angle < 0) angle += Math.PI*2;

    let gapStart = gapAngle - gapSize/2;
    let gapEnd = gapAngle + gapSize/2;

    if(dist > radius){
      if(angle > gapStart && angle < gapEnd){
        // boÅŸluktan Ã§Ä±ktÄ± â†’ elendi
        c.eliminated = true;
        addEliminated(c);
      } else {
        // duvara Ã§arptÄ± â†’ sek
        let normalX = dx/dist;
        let normalY = dy/dist;
        let dot = c.dx*normalX + c.dy*normalY;
        c.dx -= 2*dot*normalX;
        c.dy -= 2*dot*normalY;

        c.x = centerX + normalX * (radius-2);
        c.y = centerY + normalY * (radius-2);
      }
    }
  });

  let alive = countries.filter(c=>!c.eliminated);
  if(alive.length === 1){
    setTimeout(resetGame, 3000);
  }
}

function addEliminated(country){
  const box = document.createElement("div");
  box.className="flagBox";
  box.innerHTML = `<div class="flagEmoji">${country.emoji}</div>
                   <div class="flagName">${country.name}</div>`;
  eliminatedDiv.appendChild(box);
}

function resetGame(){
  location.reload();
}

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawArena();
  drawFlags();
  update();
  requestAnimationFrame(animate);
}

animate();
</script>
