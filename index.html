<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flag Arena</title>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial;
  overflow:hidden;
}

#title{
  text-align:center;
  font-size:38px;
  margin-top:20px;
  letter-spacing:4px;
}

canvas{
  display:block;
  margin:auto;
  margin-top:20px;
}

#bottomArea{
  position:fixed;
  bottom:0;
  width:100%;
  height:180px;
  background:#111;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-content:flex-start;
  gap:6px;
  padding:10px;
  box-sizing:border-box;
  overflow-y:auto;
}

.eliminated{
  text-align:center;
  font-size:9px;
}

.eliminated img{
  width:28px;
  display:block;
  margin:auto;
}
</style>
</head>

<body>

<div id="title">FLAG ARENA</div>
<canvas id="arena" width="700" height="700"></canvas>
<div id="bottomArea"></div>

<script>

const canvas = document.getElementById("arena");
const ctx = canvas.getContext("2d");

const centerX = canvas.width/2;
const centerY = canvas.height/2;

let radius = 280;
let gapSize = 0.6;
let shrinkSpeed = 0.03;

const countryCodes = [
"tr","us","de","fr","gb","it","es","br","ar","jp",
"cn","ru","ca","au","mx","kr","nl","se","no","pl",
"sa","ae","gr","pt","ch","be","at","dk","fi","hu"
];

let flags = {};
let countries = [];
let eliminated = [];

let loaded = 0;

countryCodes.forEach(code=>{
  const img = new Image();
  img.src = `https://flagcdn.com/w40/${code}.png`;
  img.onload = ()=>{
    loaded++;
    if(loaded === countryCodes.length){
      startGame();
    }
  };
  flags[code] = img;
});

function startGame(){

  countryCodes.forEach(code=>{

    let angle = Math.random()*Math.PI*2;
    let r = Math.random()*(radius-60);

    countries.push({
      code:code,
      x:centerX + Math.cos(angle)*r,
      y:centerY + Math.sin(angle)*r,
      vx:(Math.random()-0.5)*3,
      vy:(Math.random()-0.5)*3
    });
  });

  animate();
}

function drawCircle(){

  ctx.beginPath();
  ctx.arc(centerX,centerY,radius,0,Math.PI*2);
  ctx.strokeStyle="white";
  ctx.lineWidth=3;
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(centerX,centerY,radius,-gapSize/2,gapSize/2);
  ctx.strokeStyle="black";
  ctx.lineWidth=6;
  ctx.stroke();
}

function updateBottom(){

  const area = document.getElementById("bottomArea");
  area.innerHTML="";

  eliminated.forEach(c=>{
    const div = document.createElement("div");
    div.className="eliminated";
    div.innerHTML=
      `<img src="https://flagcdn.com/w40/${c.code}.png">
       ${c.code.toUpperCase()}`;
    area.appendChild(div);
  });
}

function animate(){

  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(radius > 170){
    radius -= shrinkSpeed;
  }

  drawCircle();

  let survivors = [];

  for(let c of countries){

    c.x += c.vx;
    c.y += c.vy;

    let dx = c.x - centerX;
    let dy = c.y - centerY;
    let distance = Math.sqrt(dx*dx + dy*dy);

    let angle = Math.atan2(dy,dx);

    // duvara çarptıysa
    if(distance >= radius-20){

      // boşluk kontrol
      if(angle > -gapSize/2 && angle < gapSize/2){
        eliminated.push(c);
        updateBottom();
        continue;
      }

      // sekme
      let normalX = dx/distance;
      let normalY = dy/distance;

      let dot = c.vx*normalX + c.vy*normalY;

      c.vx -= 2*dot*normalX;
      c.vy -= 2*dot*normalY;

      c.x = centerX + normalX*(radius-22);
      c.y = centerY + normalY*(radius-22);
    }

    ctx.drawImage(flags[c.code], c.x-15, c.y-10, 30, 20);

    ctx.fillStyle="white";
    ctx.font="10px Arial";
    ctx.textAlign="center";
    ctx.fillText(c.code.toUpperCase(), c.x, c.y+18);

    survivors.push(c);
  }

  countries = survivors;

  if(countries.length > 1){
    requestAnimationFrame(animate);
  }
}

</script>

</body>
</html>
